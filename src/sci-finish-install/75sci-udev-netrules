#!/bin/sh 

#vars
ipa=/run/udev/ipa
tmprules=/run/udev/tmp-rules--70-persistent-net.rules
targetrules=/target/etc/udev/rules.d/70-persistent-net.rules

ip a > $ipa
while read i; do
	# if string with inteface name, save it
	if (echo $i|grep -qe \^[0-9].*) then
		# if interface like eth
	#	if (cat $REPLY|grep -e \^[0-9].*|cut -d' ' -f 2|cut -d':' -f 1|grep -q eth) then
		interface="`echo $i|grep -e \^[0-9].*|cut -d' ' -f 2`"
	#	fi
	else
		if (echo $i|grep -q ether) then
			mac=`echo $i|cut -d' ' -f 2`
			string="$string$interface$mac "
		fi
	fi
done < $ipa

# generate rules file
cat << EOF > $tmprules
# This file was automatically generated by the /etc/udev/write_net_rules
# program run by the persistent-net-generator.rules rules file. installer
#
# You can modify it, as long as you keep each rule on a single line.

EOF

for i in $string; do
	if (echo $i|grep -qe \^eth) then
		echo "SUBSYSTEM==\"net\", ACTION==\"add\", ATTR{address}==\"`echo $i|cut -d':' -f 2-7`\", KERNEL=="eth*", NAME=\"`echo $i|cut -d':' -f 1`\"" >> $tmprules
		echo >> $tmprules
	fi
done
		
# copy rules file to target system
cp $tmprules $targetrules

exit 0
